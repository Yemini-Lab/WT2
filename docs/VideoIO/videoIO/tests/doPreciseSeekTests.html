<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of doPreciseSeekTests</title>
  <meta name="keywords" content="doPreciseSeekTests">
  <meta name="description" content="DOPRECISESEEKTESTS(...)">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- ../menu.html videoIO --><!-- menu.html tests -->
<h1>doPreciseSeekTests
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>DOPRECISESEEKTESTS(...)</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function doPreciseSeekTests(varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment">DOPRECISESEEKTESTS(...)
  Performs a set of tests on a video file that are designed to succeed only if
  precise seeking actually works on that file.  Note that if a file has
  a small number of frames and/or only a small variance in bitrate
  between frames, it may pass the precise seek tests when other files
  using the same codec may not.

  Any arguments given are passed directly to the videoReader constructor.

Examples:
  doPreciseSeekTests numbers.uncompressed.avi
  doPreciseSeekTests numbers.uncompressed.avi ffmpegPopen2  % linux &amp; similar
  doPreciseSeekTests numbers.uncompressed.avi ffmpegDirect  % ...if system's gcc is compatible w/ Matlab's
  doPreciseSeekTests numbers.uncompressed.avi DirectShow    % Windows

Copyright (c) 2006 Gerald Dalley
See &quot;MIT.txt&quot; in the installation directory for licensing details (especially
when using this library on GNU/Linux).</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="../../videoIO/@videoReader/close.html" class="code" title="function vr = close(vr)">close</a>	VR=CLOSE(VR)</li><li><a href="../../videoIO/@videoReader/get.html" class="code" title="function info = get(vr,varargin)">get</a>	INFO=GET(VR)</li><li><a href="../../videoIO/@videoReader/getframe.html" class="code" title="function frame = getframe(vr)">getframe</a>	FRAME=GETFRAME(VR)</li><li><a href="../../videoIO/@videoReader/next.html" class="code" title="function worked = next(vr)">next</a>	WORKED=NEXT(VR)</li><li><a href="../../videoIO/@videoReader/seek.html" class="code" title="function worked = seek(vr,fnum)">seek</a>	WORKED=SEEK(VR,FNUM)</li><li><a href="../../videoIO/@videoReader/step.html" class="code" title="function fn = step(vr, delta)">step</a>	WORKED=STEP(VR,DELTA)</li><li><a href="../../videoIO/@videoReader/videoReader.html" class="code" title="function vr = videoReader(url, varargin)">videoReader</a>	videoReader class constructor</li><li><a href="../../videoIO/@videoWriter/close.html" class="code" title="function vw = close(vw)">close</a>	VW=CLOSE(VW)</li><li><a href="../../videoIO/@videoWriter/get.html" class="code" title="function info = get(vw,varargin)">get</a>	INFO=GET(VW)</li><li><a href="assertSimilarImages.html" class="code" title="function assertSimilarImages(a,b)  %#ok<INUSD>">assertSimilarImages</a>	assertSimilarImages(a,b)</li><li><a href="doFullRead.html" class="code" title="function images = doFullRead(varargin)">doFullRead</a>	IMAGES=DOFULLREAD(...)</li><li><a href="ienter.html" class="code" title="function ienter(varargin)">ienter</a>	IENTER(...)</li><li><a href="iexit.html" class="code" title="function iexit(varargin)">iexit</a>	IEXIT(...)</li><li><a href="vrassert.html" class="code" title="function vrassert(varargin)">vrassert</a>	vrassert(testCondition)</li></ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="readIndvFrameTests.html" class="code" title="function readIndvFrameTests(plugin,ext,varargin)">readIndvFrameTests</a>	readIndvFrameTests(plugin,ext,...)</li><li><a href="readTests.html" class="code" title="function readTests(plugin)">readTests</a>	readTests(plugin)</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function dispResults(images, img, f)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function doPreciseSeekTests(varargin)</a>
0002 <span class="comment">%DOPRECISESEEKTESTS(...)</span>
0003 <span class="comment">%  Performs a set of tests on a video file that are designed to succeed only if</span>
0004 <span class="comment">%  precise seeking actually works on that file.  Note that if a file has</span>
0005 <span class="comment">%  a small number of frames and/or only a small variance in bitrate</span>
0006 <span class="comment">%  between frames, it may pass the precise seek tests when other files</span>
0007 <span class="comment">%  using the same codec may not.</span>
0008 <span class="comment">%</span>
0009 <span class="comment">%  Any arguments given are passed directly to the videoReader constructor.</span>
0010 <span class="comment">%</span>
0011 <span class="comment">%Examples:</span>
0012 <span class="comment">%  doPreciseSeekTests numbers.uncompressed.avi</span>
0013 <span class="comment">%  doPreciseSeekTests numbers.uncompressed.avi ffmpegPopen2  % linux &amp; similar</span>
0014 <span class="comment">%  doPreciseSeekTests numbers.uncompressed.avi ffmpegDirect  % ...if system's gcc is compatible w/ Matlab's</span>
0015 <span class="comment">%  doPreciseSeekTests numbers.uncompressed.avi DirectShow    % Windows</span>
0016 <span class="comment">%</span>
0017 <span class="comment">%Copyright (c) 2006 Gerald Dalley</span>
0018 <span class="comment">%See &quot;MIT.txt&quot; in the installation directory for licensing details (especially</span>
0019 <span class="comment">%when using this library on GNU/Linux).</span>
0020 
0021 <a href="ienter.html" class="code" title="function ienter(varargin)">ienter</a>(<span class="string">'&gt;&gt;&gt; %s(''%s'',...)'</span>, mfilename, varargin{1});
0022 images = <a href="doFullRead.html" class="code" title="function images = doFullRead(varargin)">doFullRead</a>(varargin{:});
0023 
0024 <span class="comment">%%% test seek and step %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0025 
0026 vr = <a href="../../videoIO/@videoReader/videoReader.html" class="code" title="function vr = videoReader(url, varargin)">videoReader</a>(varargin{:});
0027 <span class="comment">% make sure first two frames have different data (makes sure next is</span>
0028 <span class="comment">% working)</span>
0029 <a href="vrassert.html" class="code" title="function vrassert(varargin)">vrassert</a> any(any(images(:,:,1) ~= images(:,:,2)));
0030 
0031 <span class="comment">% step back one frame to 1st frame</span>
0032 <a href="vrassert.html" class="code" title="function vrassert(varargin)">vrassert</a> <a href="../../videoIO/@videoReader/next.html" class="code" title="function worked = next(vr)">next</a>(vr);                      <span class="comment">% -1 -&gt; 0</span>
0033 <a href="vrassert.html" class="code" title="function vrassert(varargin)">vrassert</a> <a href="../../videoIO/@videoReader/next.html" class="code" title="function worked = next(vr)">next</a>(vr);                      <span class="comment">% 0 -&gt; 1</span>
0034 <a href="vrassert.html" class="code" title="function vrassert(varargin)">vrassert</a> <a href="../../videoIO/@videoReader/step.html" class="code" title="function fn = step(vr, delta)">step</a>(vr, -1);                  <span class="comment">% 1 -&gt; 0</span>
0035 img = <a href="../../videoIO/@videoReader/getframe.html" class="code" title="function frame = getframe(vr)">getframe</a>(vr); img = uint8(sum(double(img), 3) / size(img,3));
0036 <a href="assertSimilarImages.html" class="code" title="function assertSimilarImages(a,b)  %#ok<INUSD>">assertSimilarImages</a>(images(:,:,1), img);
0037 
0038 <span class="comment">% seek backward to 1st frame</span>
0039 <a href="vrassert.html" class="code" title="function vrassert(varargin)">vrassert</a> <a href="../../videoIO/@videoReader/next.html" class="code" title="function worked = next(vr)">next</a>(vr);                      <span class="comment">% 0 -&gt; 1</span>
0040 <a href="vrassert.html" class="code" title="function vrassert(varargin)">vrassert</a> <a href="../../videoIO/@videoReader/seek.html" class="code" title="function worked = seek(vr,fnum)">seek</a>(vr, 0);                   <span class="comment">% 1 -&gt; 0</span>
0041 img = <a href="../../videoIO/@videoReader/getframe.html" class="code" title="function frame = getframe(vr)">getframe</a>(vr); img = uint8(sum(double(img), 3) / size(img,3));
0042 <a href="assertSimilarImages.html" class="code" title="function assertSimilarImages(a,b)  %#ok<INUSD>">assertSimilarImages</a>(images(:,:,1), img);
0043 <span class="comment">% step nowhere</span>
0044 <a href="vrassert.html" class="code" title="function vrassert(varargin)">vrassert</a> <a href="../../videoIO/@videoReader/step.html" class="code" title="function fn = step(vr, delta)">step</a>(vr, 0);                   <span class="comment">% 0 -&gt; 0</span>
0045 img = <a href="../../videoIO/@videoReader/getframe.html" class="code" title="function frame = getframe(vr)">getframe</a>(vr); img = uint8(sum(double(img), 3) / size(img,3));
0046 <a href="assertSimilarImages.html" class="code" title="function assertSimilarImages(a,b)  %#ok<INUSD>">assertSimilarImages</a>(images(:,:,1), img);
0047 
0048 <span class="comment">% step back one frame</span>
0049 <a href="vrassert.html" class="code" title="function vrassert(varargin)">vrassert</a> <a href="../../videoIO/@videoReader/next.html" class="code" title="function worked = next(vr)">next</a>(vr);                      <span class="comment">% 0 -&gt; 1</span>
0050 <a href="vrassert.html" class="code" title="function vrassert(varargin)">vrassert</a> <a href="../../videoIO/@videoReader/next.html" class="code" title="function worked = next(vr)">next</a>(vr);                      <span class="comment">% 1 -&gt; 2</span>
0051 <a href="vrassert.html" class="code" title="function vrassert(varargin)">vrassert</a> <a href="../../videoIO/@videoReader/step.html" class="code" title="function fn = step(vr, delta)">step</a>(vr, -1);                  <span class="comment">% 2 -&gt; 1</span>
0052 img = <a href="../../videoIO/@videoReader/getframe.html" class="code" title="function frame = getframe(vr)">getframe</a>(vr); img = uint8(sum(double(img), 3) / size(img,3));
0053 <a href="assertSimilarImages.html" class="code" title="function assertSimilarImages(a,b)  %#ok<INUSD>">assertSimilarImages</a>(images(:,:,2), img);
0054 <span class="comment">% seek back one frame</span>
0055 <a href="vrassert.html" class="code" title="function vrassert(varargin)">vrassert</a> <a href="../../videoIO/@videoReader/next.html" class="code" title="function worked = next(vr)">next</a>(vr);                      <span class="comment">% 1 -&gt; 2</span>
0056 <a href="vrassert.html" class="code" title="function vrassert(varargin)">vrassert</a> <a href="../../videoIO/@videoReader/seek.html" class="code" title="function worked = seek(vr,fnum)">seek</a>(vr, 1);                   <span class="comment">% 2 -&gt; 1</span>
0057 img = <a href="../../videoIO/@videoReader/getframe.html" class="code" title="function frame = getframe(vr)">getframe</a>(vr); img = uint8(sum(double(img), 3) / size(img,3));
0058 <a href="assertSimilarImages.html" class="code" title="function assertSimilarImages(a,b)  %#ok<INUSD>">assertSimilarImages</a>(images(:,:,2), img);
0059 <span class="comment">% step back 2 frames</span>
0060 <a href="vrassert.html" class="code" title="function vrassert(varargin)">vrassert</a> <a href="../../videoIO/@videoReader/next.html" class="code" title="function worked = next(vr)">next</a>(vr);                      <span class="comment">% 1 -&gt; 2</span>
0061 <a href="vrassert.html" class="code" title="function vrassert(varargin)">vrassert</a> <a href="../../videoIO/@videoReader/next.html" class="code" title="function worked = next(vr)">next</a>(vr);                      <span class="comment">% 2 -&gt; 3</span>
0062 <a href="vrassert.html" class="code" title="function vrassert(varargin)">vrassert</a> <a href="../../videoIO/@videoReader/step.html" class="code" title="function fn = step(vr, delta)">step</a>(vr, -2);                  <span class="comment">% 3 -&gt; 1</span>
0063 img = <a href="../../videoIO/@videoReader/getframe.html" class="code" title="function frame = getframe(vr)">getframe</a>(vr); img = uint8(sum(double(img), 3) / size(img,3));
0064 <a href="assertSimilarImages.html" class="code" title="function assertSimilarImages(a,b)  %#ok<INUSD>">assertSimilarImages</a>(images(:,:,2), img);
0065 <span class="comment">% seek back 2 frames</span>
0066 <a href="vrassert.html" class="code" title="function vrassert(varargin)">vrassert</a> <a href="../../videoIO/@videoReader/next.html" class="code" title="function worked = next(vr)">next</a>(vr);                      <span class="comment">% 1 -&gt; 2</span>
0067 <a href="vrassert.html" class="code" title="function vrassert(varargin)">vrassert</a> <a href="../../videoIO/@videoReader/next.html" class="code" title="function worked = next(vr)">next</a>(vr);                      <span class="comment">% 2 -&gt; 3</span>
0068 <a href="vrassert.html" class="code" title="function vrassert(varargin)">vrassert</a> <a href="../../videoIO/@videoReader/seek.html" class="code" title="function worked = seek(vr,fnum)">seek</a>(vr, 1);                   <span class="comment">% 3 -&gt; 1</span>
0069 img = <a href="../../videoIO/@videoReader/getframe.html" class="code" title="function frame = getframe(vr)">getframe</a>(vr); img = uint8(sum(double(img), 3) / size(img,3));
0070 <a href="assertSimilarImages.html" class="code" title="function assertSimilarImages(a,b)  %#ok<INUSD>">assertSimilarImages</a>(images(:,:,2), img);
0071 <span class="comment">% step forward 2 frames</span>
0072 <a href="vrassert.html" class="code" title="function vrassert(varargin)">vrassert</a> <a href="../../videoIO/@videoReader/step.html" class="code" title="function fn = step(vr, delta)">step</a>(vr, 2);                   <span class="comment">% 1 -&gt; 3</span>
0073 img = <a href="../../videoIO/@videoReader/getframe.html" class="code" title="function frame = getframe(vr)">getframe</a>(vr); img = uint8(sum(double(img), 3) / size(img,3));
0074 <a href="assertSimilarImages.html" class="code" title="function assertSimilarImages(a,b)  %#ok<INUSD>">assertSimilarImages</a>(images(:,:,4), img);
0075 <span class="comment">% seek forward 2 frames</span>
0076 <a href="vrassert.html" class="code" title="function vrassert(varargin)">vrassert</a> <a href="../../videoIO/@videoReader/seek.html" class="code" title="function worked = seek(vr,fnum)">seek</a>(vr, 5);                   <span class="comment">% 3 -&gt; 5</span>
0077 img = <a href="../../videoIO/@videoReader/getframe.html" class="code" title="function frame = getframe(vr)">getframe</a>(vr); img = uint8(sum(double(img), 3) / size(img,3));
0078 <a href="assertSimilarImages.html" class="code" title="function assertSimilarImages(a,b)  %#ok<INUSD>">assertSimilarImages</a>(images(:,:,6), img);
0079 <span class="keyword">if</span> (size(images,3)&gt;30*7)
0080   <span class="comment">% step forward &gt; 5 seconds</span>
0081   <a href="vrassert.html" class="code" title="function vrassert(varargin)">vrassert</a> <a href="../../videoIO/@videoReader/seek.html" class="code" title="function worked = seek(vr,fnum)">seek</a>(vr,0);
0082   <a href="vrassert.html" class="code" title="function vrassert(varargin)">vrassert</a> <a href="../../videoIO/@videoReader/step.html" class="code" title="function fn = step(vr, delta)">step</a>(vr,6*30);
0083   img = <a href="../../videoIO/@videoReader/getframe.html" class="code" title="function frame = getframe(vr)">getframe</a>(vr); img = uint8(sum(double(img), 3) / size(img,3));
0084   <a href="assertSimilarImages.html" class="code" title="function assertSimilarImages(a,b)  %#ok<INUSD>">assertSimilarImages</a>(images(:,:,6*30+1), img);
0085   <span class="comment">% seek forward &gt; 5 seconds</span>
0086   <a href="vrassert.html" class="code" title="function vrassert(varargin)">vrassert</a> <a href="../../videoIO/@videoReader/seek.html" class="code" title="function worked = seek(vr,fnum)">seek</a>(vr,0);
0087   <a href="vrassert.html" class="code" title="function vrassert(varargin)">vrassert</a> <a href="../../videoIO/@videoReader/seek.html" class="code" title="function worked = seek(vr,fnum)">seek</a>(vr,6*30);
0088   img = <a href="../../videoIO/@videoReader/getframe.html" class="code" title="function frame = getframe(vr)">getframe</a>(vr); img = uint8(sum(double(img), 3) / size(img,3));
0089   <a href="assertSimilarImages.html" class="code" title="function assertSimilarImages(a,b)  %#ok<INUSD>">assertSimilarImages</a>(images(:,:,6*30+1), img);
0090 <span class="keyword">end</span>
0091 
0092 <span class="comment">% random seeks</span>
0093 info = <a href="../../videoIO/@videoReader/get.html" class="code" title="function info = get(vr,varargin)">get</a>(vr);
0094 <span class="keyword">for</span> f=floor(rand(1,100)*(info.numFrames-1))
0095   <a href="vrassert.html" class="code" title="function vrassert(varargin)">vrassert</a> <a href="../../videoIO/@videoReader/seek.html" class="code" title="function worked = seek(vr,fnum)">seek</a>(vr,f);
0096   img = <a href="../../videoIO/@videoReader/getframe.html" class="code" title="function frame = getframe(vr)">getframe</a>(vr); img = uint8(sum(double(img), 3) / size(img,3));
0097   <a href="assertSimilarImages.html" class="code" title="function assertSimilarImages(a,b)  %#ok<INUSD>">assertSimilarImages</a>(images(:,:,f+1), img);
0098 <span class="keyword">end</span>
0099 
0100 <a href="../../videoIO/@videoReader/close.html" class="code" title="function vr = close(vr)">close</a>(vr);
0101 
0102 <a href="iexit.html" class="code" title="function iexit(varargin)">iexit</a>(<span class="string">'&lt;&lt;&lt; doPreciseSeekTests(''%s'',...)'</span>, varargin{1});
0103 
0104 <span class="comment">%-------------------------------------------------------------</span>
0105 <a name="_sub1" href="#_subfunctions" class="code">function dispResults(images, img, f) </a><span class="comment">%#ok&lt;DEFNU&gt;</span>
0106 <span class="comment">% Little helper function to show results when precise seeks don't work</span>
0107 <span class="comment">% as expected</span>
0108 
0109 subplot(311); 
0110 imshow(images(:,:,f+1)); 
0111 title(sprintf(<span class="string">'linearly-read frame %d'</span>, f));
0112 
0113 subplot(312); 
0114 imshow(img); 
0115 title(<span class="string">'read via seeking'</span>);
0116 
0117 subplot(313);
0118 imshow(double(images(:,:,f+1)) - double(img), []);
0119 colorbar;
0120 title(<span class="string">'diff image'</span>);</pre></div>
<hr><address>Generated on Thu 27-Jun-2013 11:03:38 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>